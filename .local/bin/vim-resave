#!/usr/bin/env bash
set -eo pipefail

# eligible=()

# for file in "$@"; do
#     # skip non-existing files
#     if [[ ! -e "$file" ]]; then
#         echo "> doesn't exist: ${file}"
#         continue
#     fi
#     # skip any non-text files
#     case "$(uchardet "$file")" in
#         ASCII|UTF-8)
#             ;;
#         *)
#             echo "> not text-file: ${file}"
#             continue
#             ;;
#     esac
#     eligible+=("$file")
# done

# # If nothing to process, exit quietly
# ((${#eligible[@]})) || exit 0

for file in "$@" ; do
    echo "> ${file}"
done

# One headless Vim instance for all files
# Preserves your original order: set noendofline -> write -> FixFileFormat
vim --headless \
    -c 'argdo set noendofline | silent! w | silent! FixFileFormat' \
    -c 'qa' -- "$@"
    # -c 'qa' -- "${eligible[@]}"
