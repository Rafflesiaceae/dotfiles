#!/bin/bash
# ! This just prints last downloaded file to stdout
unset -v latest

usage() {
    echo "usage: [-m|--move][-e|--edit]"
    exit 1
}

cli_edit=
cli_move=
cli_sha=
while :; do
    case $1 in
        -h|-\?|--help)
            usage; exit ;;
        -e|--edit)
            cli_edit=1
            ;;
        -sha|--sha)
            cli_sha=1
            ;;
        -m|--move)
            cli_move=1
            ;;
        --)
            shift || usage
            break
            ;;
        -?*) printf 'WARN: Unknown option (ignored): %s\n' "$1" >&2 ;;
        *) break ;;
    esac

    shift || usage
done

# find latest file
for file in "$HOME/Downloads"/*; do
  [[ $file -nt $latest ]] && latest=$file
done

# find latest file
if [[ $cli_edit ]]; then
    "$EDITOR" "$latest"
elif [[ $cli_move ]]; then
    ( set -x; mv "$latest" "$PWD" )
elif [[ $cli_sha ]]; then
    sha256sum "$(lastdl)"
else
    echo "$latest"
fi
