#!/usr/bin/env bash
set -eo pipefail
IFS=':' read -ra vars <<<"$2"

titleb64="${vars[2]}"
title=$(echo "$titleb64" | base64 -d)
aria="${vars[4]}"

cached="${HOME}/.cache/chatgpt-on-state-change"
titled="${cached}/${titleb64}"

mkdir -p "$titled"

startedf=${titled}/started

case "$aria" in
"Start voice mode")
    if [[ -f "$startedf" ]]; then
        rm "$startedf"
        notify-send --urgency=low "ChatGPT" "Finished: $title"
    fi
    ;;
"Send prompt") ;;
"Stop streaming")
    touch "$startedf"
    ;;
esac
