#!/usr/bin/env bash
set -eo pipefail

if [[ ! -e "$1" ]]; then
    echo "> pass an unsigned .jar file" >&2
    exit 1
fi

unsigned_apk="$1"
aligned_apk="${unsigned_apk//-unsigned/-tmp-aligned}"
signed_apk="${unsigned_apk//-unsigned/-signed}"

set -x
rm -rf "$aligned_apk"
zipalign -v 4 "$1" "$aligned_apk"
apksigner sign \
    --ks ~/.android/debug.keystore \
    --ks-key-alias androiddebugkey \
    --ks-pass pass:android \
    --key-pass pass:android \
    --out "$signed_apk" \
    "$aligned_apk"
