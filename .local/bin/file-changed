#!/bin/bash
set -eo pipefail

hash() {  xxh128sum - | cut -d ' ' -f1; }

cached=$HOME/.cache/file-changed
mkdir -p "$cached" || true

changed=
for arg in "$@" ; do
    realpath="$(realpath "$arg")"

    id=$(printf "%s" "$realpath" | hash)
    cache_path="${cached}/${id}"
    content_hash=$(hash < "$realpath")

    previous_content_hash=
    if [[ -r "$cache_path" ]]; then
        previous_content_hash="$(cat "$cache_path")"
        if [[ "$previous_content_hash" != "$content_hash" ]]; then
            changed=1
        fi
    else
        changed=1
    fi

    echo "$content_hash" > "$cache_path"
done

if [[ $changed ]]; then
    exit 0
else
    exit 1
fi
