#!/usr/bin/env bash
set -eo pipefail

# Read clipboard contents
content="$(cb -o)"

# Abort if content is already fenced
first_line="${content%%$'\n'*}"
if [[ $first_line == '```' ]]; then
    exit 0
fi

# Remove empty beginning and trailing empty lines,
# but keep empty lines in the middle intact
#
# Explanation for pipes below:
#   - drop leading blank lines
#   - reverse lines
#   - drop "leading" blank lines (originally trailing)
#   - restore original order
content=$(printf '%s\n' "$content" \
  | sed '/./,$!d' \
  | tac \
  | sed '/./,$!d' \
  | tac
)

# Surround with ```
# shellcheck disable=SC2016
printf '```\n%s\n```\n\n' "$content" | cb -i
