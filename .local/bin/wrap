#!/usr/bin/env bash
set -euo pipefail

# --- prerequisites -----------------------------------------------------------
for dep in zip xclip python3; do
  if ! command -v "$dep" >/dev/null 2>&1; then
    echo "Error: '$dep' is required but not installed." >&2
    exit 1
  fi
done

# --- where to put the archive ------------------------------------------------
outdir="${HOME}/.cache/wrap"
mkdir -p "$outdir"

base="$(basename "$PWD")"
ts="$(date -u +%Y%m%dT%H%M%SZ)"   # alpha-sortable, UTC
dest="${outdir}/${base}-${ts}.zip"

# --- build the zip (as a single top-level folder, includes dotfiles) ---------
parent="$(dirname "$PWD")"
(
  cd "$parent"
  zip -rq "$dest" "$base"
)

cb -cf "$dest"
